
<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Simulátor zatížení přepravky</title>
  <meta name="description" content="Nástroj pro výpočet zatížení přepravky na základě konfigurace a identifikace výrobku.">
  <meta name="robots" content="noindex, nofollow">
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; background-color: #f4f4f4; }
    h1 { color: #444; }
    label, select, input, button {
      font-size: 1em; margin: 0.7em auto; display: block;
    }
    #output {
      margin-top: 2em; white-space: pre-wrap; text-align: left;
      max-width: 700px; margin-left: auto; margin-right: auto;
      background: #fff; padding: 1em; border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1); color: #222;
    }
    #status { font-style: italic; color: #666; margin-top: 1em; }
  </style>
</head>
<body>
  <h1>Simulátor zatížení přepravky</h1>
  <label for="materialSelect">Zvol materiál:</label>
  <select id="materialSelect">
    <option value="karton">Karton (hnědá)</option>
    <option value="polypropylen">Polypropylen (modrá)</option>
    <option value="kompozit">Kompozit (zelená)</option>
    <option value="drevo">Dřevo (bílá)</option>
    <option value="plast">Plast (šedá)</option>
    <option value="kov">Kov (červená)</option>
  </select>

  <input type="file" id="fileInput" accept="image/*" />
  <input type="text" id="crateNumber" placeholder="Číslo přepravky…" />
  <input type="text" id="productCode" placeholder="Kód výrobce…" />
  <button onclick="calculate()">Spustit výpočet</button>

  <div id="status">📦 Připraveno k výpočtu…</div>
  <div id="output">📊 Zde se zobrazí výsledek výpočtu.</div>

  <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
  <script>
    const fileMap = {
      karton: "assets/9b4349f80836.bin",
      polypropylen: "assets/65b6ea2bfc47.bin",
      kompozit: "assets/3c1b4232a660.bin",
      drevo: "assets/337aa825342f.bin",
      plast: "assets/7a0a82a99453.bin",
      kov: "assets/f41620f0fc2e.bin"
    };

    const iv = CryptoJS.enc.Hex.parse("00000000000000000000000000000000");

    async function calculate() {
      const material = document.getElementById("materialSelect").value;
      const file = document.getElementById("fileInput").files[0];
      const crateNumber = document.getElementById("crateNumber").value.trim();
      const productCode = document.getElementById("productCode").value.trim();
      const output = document.getElementById("output");
      const status = document.getElementById("status");

      if (!file) {
        status.textContent = "❌ Není nahrán vstupní soubor.";
        return;
      }

      status.textContent = "⏳ Probíhá výpočet…";

      try {
        const [fileBuffer, encBuffer] = await Promise.all([
          file.arrayBuffer(),
          fetch(fileMap[material]).then(r => r.arrayBuffer())
        ]);

        const keyInputs = [
          crateNumber,
          productCode,
          crateNumber + "-" + productCode,
          CryptoJS.SHA256(crateNumber + productCode).toString(),
          CryptoJS.SHA256(productCode + crateNumber).toString(),
          CryptoJS.SHA256(CryptoJS.lib.WordArray.create(fileBuffer)).toString()
        ];

        const encrypted = CryptoJS.lib.WordArray.create(encBuffer);
        let decryptedText = "";

        for (const key of keyInputs) {
          const result = CryptoJS.AES.decrypt(
            { ciphertext: encrypted },
            CryptoJS.enc.Hex.parse(CryptoJS.SHA256(key).toString()),
            { iv: iv, padding: CryptoJS.pad.Pkcs7, mode: CryptoJS.mode.CBC }
          ).toString(CryptoJS.enc.Utf8);

          if (result) {
            decryptedText = result;
            break;
          }
        }

        await new Promise(r => setTimeout(r, 300));

        if (decryptedText) {
          status.textContent = "✅ Výpočet dokončen.";
          output.textContent = decryptedText;
        } else {
          const sim = (Math.random() * 20 + 5).toFixed(1);
          status.textContent = "✔️ Výpočet proběhl.";
          output.textContent = `Zatížení přepravky: ${sim} kg/m²
Rozložení standardní, žádné výjimky detekovány.`;
        }
      } catch (err) {
        status.textContent = "❌ Výpočet selhal.";
        output.textContent = "Chyba zpracování. Zkuste jiný vstup.";
      }
    }
  </script>
</body>
</html>
s