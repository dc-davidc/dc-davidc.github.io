
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Protected Note ‚Äì Obr√°zek jako kl√≠ƒç (mobil safe)</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; }
    #output { margin-top: 2em; white-space: pre-wrap; text-align: left; max-width: 700px; margin: 2em auto; }
    input[type="file"] { margin: 1em auto; display: block; }
    #status { font-style: italic; margin-top: 1em; color: #555; }
  </style>
</head>
<body>
  <h1>Protected Note</h1>
  <p>Vyber obr√°zek jako kl√≠ƒç k odemknut√≠ zpr√°vy:</p>
  <input type="file" id="imageInput" accept="image/*" />
  <div id="status">‚è≥ ƒåek√°m na v√Ωbƒõr obr√°zku‚Ä¶</div>
  <div id="output"></div>

  <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
  <script>
    const encFile = "assets/ca26b1c607dc.bin";
    const iv = CryptoJS.enc.Hex.parse("00000000000000000000000000000000");

    async function decryptWithImageKey(imageBytes) {
      try {
        document.getElementById("status").textContent = "üîê De≈°ifruji...";
        const response = await fetch(encFile);
        const buffer = await response.arrayBuffer();
        const wordArray = CryptoJS.lib.WordArray.create(buffer);

        const imageWordArray = CryptoJS.lib.WordArray.create(imageBytes);
        const key = CryptoJS.SHA256(imageWordArray).toString();

        const decrypted = CryptoJS.AES.decrypt(
          { ciphertext: wordArray },
          CryptoJS.enc.Hex.parse(key),
          { iv: iv, padding: CryptoJS.pad.Pkcs7, mode: CryptoJS.mode.CBC }
        );

        const text = decrypted.toString(CryptoJS.enc.Utf8);
        if (text) {
          document.getElementById("output").textContent = text;
          document.getElementById("status").textContent = "‚úÖ √öspƒõ≈°nƒõ odemƒçeno";
        } else {
          document.getElementById("output").textContent = "‚ùå Nespr√°vn√Ω obr√°zek nebo ≈°patn√Ω kl√≠ƒç.";
          document.getElementById("status").textContent = "‚ö†Ô∏è De≈°ifrov√°n√≠ selhalo.";
        }
      } catch (e) {
        document.getElementById("output").textContent = "‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ nebo de≈°ifrov√°n√≠.";
        document.getElementById("status").textContent = "‚ö†Ô∏è V√Ωjimka: " + e.message;
      }
    }

    document.getElementById("imageInput").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (!file) return;
      document.getElementById("status").textContent = "üì• Naƒç√≠t√°m obr√°zek...";
      const reader = new FileReader();
      reader.onload = function(event) {
        try {
          const arrayBuffer = event.target.result;
          decryptWithImageKey(arrayBuffer);
        } catch (err) {
          document.getElementById("output").textContent = "‚ùå Chyba p≈ôi ƒçten√≠ souboru.";
          document.getElementById("status").textContent = "‚ö†Ô∏è Soubor nelze zpracovat.";
        }
      };
      reader.onerror = function() {
        document.getElementById("output").textContent = "‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ obr√°zku.";
        document.getElementById("status").textContent = "‚ö†Ô∏è FileReader selhal.";
      };
      reader.readAsArrayBuffer(file);
    });
  </script>
</body>
</html>
s