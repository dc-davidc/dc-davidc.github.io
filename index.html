
<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Vizuální výběr a test kompatibility</title>
  <meta name="robots" content="noindex, nofollow">
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; background-color: #f7f7f7; }
    h1 { color: #444; }
    select, input[type="password"], input[type="file"], button {
      font-size: 1em; margin: 1em auto; display: block;
    }
    #output {
      margin-top: 2em; white-space: pre-wrap; text-align: left;
      max-width: 700px; margin-left: auto; margin-right: auto;
      background: #fff; padding: 1em; border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    #status { font-style: italic; color: #666; margin-top: 1em; }
  </style>
</head>
<body>
  <h1>Výběr barvy a vstupních dat</h1>
  <p>Vyber barvu konfigurace a nahraj doplňující soubor:</p>

  <label for="colorSelect">Barva schématu:</label>
  <select id="colorSelect">
    <option value="red">Červená</option>
    <option value="pink">Růžová</option>
    <option value="green">Zelená</option>
    <option value="brown">Hnědá</option>
    <option value="blue">Modrá</option>
    <option value="yellow">Žlutá</option>
  </select>

  <input type="file" id="fileInput" accept="image/*" />
  <input type="password" id="passInput" placeholder="Volitelný přístupový kód…" />
  <button onclick="runTest()">Spustit kontrolu</button>

  <div id="status">Připraveno k testování…</div>
  <div id="output">Výsledky se objeví zde.</div>

  <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
  <script>
    const files = {
      red: "assets/9b4349f80836.bin",
      pink: "assets/65b6ea2bfc47.bin",
      green: "assets/3c1b4232a660.bin",
      brown: "assets/337aa825342f.bin",
      blue: "assets/7a0a82a99453.bin",
      yellow: "assets/f41620f0fc2e.bin"
    };

    const iv = CryptoJS.enc.Hex.parse("00000000000000000000000000000000");

    async function runTest() {
      const color = document.getElementById("colorSelect").value;
      const file = document.getElementById("fileInput").files[0];
      const pass = document.getElementById("passInput").value.trim();
      const output = document.getElementById("output");
      const status = document.getElementById("status");

      if (!file) {
        status.textContent = "❌ Prosím vyber soubor.";
        return;
      }

      status.textContent = "⏳ Načítám data…";

      try {
        const [fileBuffer, encResponse] = await Promise.all([
          file.arrayBuffer(),
          fetch(files[color]).then(r => r.arrayBuffer())
        ]);

        const imageKey = CryptoJS.lib.WordArray.create(fileBuffer);
        const passKey = CryptoJS.SHA256(pass).toString();

        const possibleKeys = [
          CryptoJS.SHA256(imageKey).toString(),
          passKey
        ];

        const encWordArray = CryptoJS.lib.WordArray.create(encResponse);
        let decryptedText = "";

        for (const key of possibleKeys) {
          const decrypted = CryptoJS.AES.decrypt(
            { ciphertext: encWordArray },
            CryptoJS.enc.Hex.parse(key),
            { iv: iv, padding: CryptoJS.pad.Pkcs7, mode: CryptoJS.mode.CBC }
          ).toString(CryptoJS.enc.Utf8);

          if (decrypted) {
            decryptedText = decrypted;
            break;
          }
        }

        await new Promise(r => setTimeout(r, 400)); // prodleva pro realismus

        if (decryptedText) {
          status.textContent = "✅ Úspěšně analyzováno.";
          output.textContent = decryptedText;
        } else {
          const fakeStats = Math.floor(Math.random() * 1000);
          status.textContent = "✔️ Kompatibilita zkontrolována.";
          output.textContent = `Soubor ${file.name} analyzován.
Přibližná velikost v blocích: ${fakeStats}.
Nebyly detekovány specifické vzory.`;
        }
      } catch (e) {
        status.textContent = "❌ Chyba při zpracování.";
        output.textContent = "Technický výpadek nebo nekompatibilní vstup.";
      }
    }
  </script>
</body>
</html>
