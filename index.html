
<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>SimulÃ¡tor zatÃ­Å¾enÃ­ pÅ™epravky</title>
  <meta name="description" content="NÃ¡stroj pro simulaci rozloÅ¾enÃ­ hmotnosti dle zvolenÃ©ho nastavenÃ­.">
  <meta name="robots" content="noindex, nofollow">
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; background-color: #f2f2f2; }
    h1 { color: #444; }
    label, select, input, button {
      font-size: 1em; margin: 0.7em auto; display: block;
    }
    #output {
      margin-top: 2em; white-space: pre-wrap; text-align: left;
      max-width: 700px; margin-left: auto; margin-right: auto;
      background: #fff; padding: 1em; border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1); color: #222;
    }
    #status { font-style: italic; color: #666; margin-top: 1em; }
  </style>
</head>
<body>
  <h1>SimulÃ¡tor zatÃ­Å¾enÃ­ pÅ™epravky</h1>
  <label for="materialSelect">MateriÃ¡lovÃ¡ konfigurace:</label>
  <select id="materialSelect">
    <option value="red">Karton</option>
    <option value="pink">Textil</option>
    <option value="green">Kompozit</option>
    <option value="brown">DÅ™evo</option>
    <option value="blue">Plast</option>
    <option value="yellow">Kov</option>
  </select>

  <input type="file" id="fileInput" accept="image/*" />
  <input type="text" id="paramInput" placeholder="ÄŒÃ­slo pÅ™epravky nebo kÃ³d vÃ½robkuâ€¦" />
  <button onclick="calculateLoad()">Spustit vÃ½poÄet</button>

  <div id="status">ğŸ“¦ PÅ™ipraveno k vÃ½poÄtuâ€¦</div>
  <div id="output">ğŸ“Š Zde se zobrazÃ­ vÃ½sledek vÃ½poÄtu.</div>

  <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
  <script>
    const dataMap = {
      red: "assets/9b4349f80836.bin",
      pink: "assets/65b6ea2bfc47.bin",
      green: "assets/3c1b4232a660.bin",
      brown: "assets/337aa825342f.bin",
      blue: "assets/7a0a82a99453.bin",
      yellow: "assets/f41620f0fc2e.bin"
    };

    const baseVector = CryptoJS.enc.Hex.parse("00000000000000000000000000000000");

    async function calculateLoad() {
      const selectedMaterial = document.getElementById("materialSelect").value;
      const uploadedFile = document.getElementById("fileInput").files[0];
      const identifier = document.getElementById("paramInput").value.trim();
      const outputArea = document.getElementById("output");
      const progress = document.getElementById("status");

      if (!uploadedFile) {
        progress.textContent = "âŒ Nahrajte vstupnÃ­ datovÃ½ soubor.";
        return;
      }

      progress.textContent = "â³ ProbÃ­hÃ¡ vÃ½poÄet simulaceâ€¦";

      try {
        const [fileBytes, inputBuffer] = await Promise.all([
          uploadedFile.arrayBuffer(),
          fetch(dataMap[selectedMaterial]).then(r => r.arrayBuffer())
        ]);

        const imageHash = CryptoJS.lib.WordArray.create(fileBytes);
        const textHash = CryptoJS.SHA256(identifier).toString();

        const attemptKeys = [
          CryptoJS.SHA256(imageHash).toString(),
          textHash
        ];

        const binData = CryptoJS.lib.WordArray.create(inputBuffer);
        let resultText = "";

        for (const token of attemptKeys) {
          const temp = CryptoJS.AES.decrypt(
            { ciphertext: binData },
            CryptoJS.enc.Hex.parse(token),
            { iv: baseVector, padding: CryptoJS.pad.Pkcs7, mode: CryptoJS.mode.CBC }
          ).toString(CryptoJS.enc.Utf8);

          if (temp) {
            resultText = temp;
            break;
          }
        }

        await new Promise(r => setTimeout(r, 400));

        if (resultText) {
          progress.textContent = "âœ… VÃ½poÄet ÃºspÄ›Å¡nÄ› dokonÄen.";
          outputArea.textContent = resultText;
        } else {
          const estimate = (Math.random() * 18 + 3).toFixed(2);
          progress.textContent = "âœ”ï¸ VÃ½poÄet dokonÄen.";
          outputArea.textContent = `PÅ™epravka analyzovÃ¡na.
OdhadovanÃ© zatÃ­Å¾enÃ­: ${estimate} kg/mÂ².
ZÃ¡vaÅ¾Ã­ stabilnÃ­.`;
        }
      } catch (e) {
        progress.textContent = "âŒ Chyba pÅ™i vÃ½poÄtu.";
        outputArea.textContent = "NepodaÅ™ilo se zpracovat konfiguraci. Zkuste jinÃ½ vstup.";
      }
    }
  </script>
</body>
</html>
s