
<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>SimulÃ¡tor zatÃ­Å¾enÃ­ pÅ™epravky</title>
  <meta name="description" content="NÃ¡stroj pro vÃ½poÄet zatÃ­Å¾enÃ­ pÅ™epravky na zÃ¡kladÄ› konfigurace a identifikace vÃ½robku.">
  <meta name="robots" content="noindex, nofollow">
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; background-color: #f4f4f4; }
    h1 { color: #444; }
    label, select, input, button {
      font-size: 1em; margin: 0.7em auto; display: block;
    }
    #output {
      margin-top: 2em; white-space: pre-wrap; text-align: left;
      max-width: 700px; margin-left: auto; margin-right: auto;
      background: #fff; padding: 1em; border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1); color: #222;
    }
    #status { font-style: italic; color: #666; margin-top: 1em; }
  </style>
</head>
<body>
  <h1>SimulÃ¡tor zatÃ­Å¾enÃ­ pÅ™epravky</h1>
  <label for="materialSelect">Zvol materiÃ¡l:</label>
  <select id="materialSelect">
    <option value="karton">Karton (hnÄ›dÃ¡)</option>
    <option value="polypropylen">Polypropylen (modrÃ¡)</option>
    <option value="kompozit">Kompozit (zelenÃ¡)</option>
    <option value="drevo">DÅ™evo (bÃ­lÃ¡)</option>
    <option value="plast">Plast (Å¡edÃ¡)</option>
    <option value="kov">Kov (ÄervenÃ¡)</option>
  </select>

  <input type="file" id="fileInput" accept="image/*" />
  <input type="text" id="crateNumber" placeholder="ÄŒÃ­slo pÅ™epravkyâ€¦" />
  <input type="text" id="productCode" placeholder="KÃ³d vÃ½robceâ€¦" />
  <button onclick="calculate()">Spustit vÃ½poÄet</button>

  <div id="status">ğŸ“¦ PÅ™ipraveno k vÃ½poÄtuâ€¦</div>
  <div id="output">ğŸ“Š Zde se zobrazÃ­ vÃ½sledek vÃ½poÄtu.</div>

  <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
  <script>
    const fileMap = {
      karton: "assets/9b4349f80836.bin",
      polypropylen: "assets/65b6ea2bfc47.bin",
      kompozit: "assets/3c1b4232a660.bin",
      drevo: "assets/337aa825342f.bin",
      plast: "assets/7a0a82a99453.bin",
      kov: "assets/f41620f0fc2e.bin"
    };

    const iv = CryptoJS.enc.Hex.parse("00000000000000000000000000000000");

    async function calculate() {
      const material = document.getElementById("materialSelect").value;
      const file = document.getElementById("fileInput").files[0];
      const crateNumber = document.getElementById("crateNumber").value.trim();
      const productCode = document.getElementById("productCode").value.trim();
      const output = document.getElementById("output");
      const status = document.getElementById("status");

      if (!file) {
        status.textContent = "âŒ NenÃ­ nahrÃ¡n vstupnÃ­ soubor.";
        return;
      }

      status.textContent = "â³ ProbÃ­hÃ¡ vÃ½poÄetâ€¦";

      try {
        const [fileBuffer, encBuffer] = await Promise.all([
          file.arrayBuffer(),
          fetch(fileMap[material]).then(r => r.arrayBuffer())
        ]);

        const keyInputs = [
          crateNumber,
          productCode,
          crateNumber + "-" + productCode,
          CryptoJS.SHA256(crateNumber + productCode).toString(),
          CryptoJS.SHA256(productCode + crateNumber).toString(),
          CryptoJS.SHA256(CryptoJS.lib.WordArray.create(fileBuffer)).toString()
        ];

        const encrypted = CryptoJS.lib.WordArray.create(encBuffer);
        let decryptedText = "";

        for (const key of keyInputs) {
          const result = CryptoJS.AES.decrypt(
            { ciphertext: encrypted },
            CryptoJS.enc.Hex.parse(CryptoJS.SHA256(key).toString()),
            { iv: iv, padding: CryptoJS.pad.Pkcs7, mode: CryptoJS.mode.CBC }
          ).toString(CryptoJS.enc.Utf8);

          if (result) {
            decryptedText = result;
            break;
          }
        }

        await new Promise(r => setTimeout(r, 300));

        if (decryptedText) {
          status.textContent = "âœ… VÃ½poÄet dokonÄen.";
          output.textContent = decryptedText;
        } else {
          const sim = (Math.random() * 20 + 5).toFixed(1);
          status.textContent = "âœ”ï¸ VÃ½poÄet probÄ›hl.";
          output.textContent = `ZatÃ­Å¾enÃ­ pÅ™epravky: ${sim} kg/mÂ²
RozloÅ¾enÃ­ standardnÃ­, Å¾Ã¡dnÃ© vÃ½jimky detekovÃ¡ny.`;
        }
      } catch (err) {
        status.textContent = "âŒ VÃ½poÄet selhal.";
        output.textContent = "Chyba zpracovÃ¡nÃ­. Zkuste jinÃ½ vstup.";
      }
    }
  </script>
</body>
</html>
s