
<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>SimulÃ¡tor zatÃ­Å¾enÃ­ pÅ™epravky</title>
  <meta name="description" content="NÃ¡stroj pro simulaci rozloÅ¾enÃ­ hmotnosti dle vstupnÃ­ch parametrÅ¯.">
  <meta name="robots" content="noindex, nofollow">
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; background-color: #f3f3f3; }
    h1 { color: #333; }
    label, select, input, button {
      font-size: 1em; margin: 0.7em auto; display: block;
    }
    #output {
      margin-top: 2em; white-space: pre-wrap; text-align: left;
      max-width: 700px; margin-left: auto; margin-right: auto;
      background: #fff; padding: 1em; border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1); color: #222;
    }
    #status { font-style: italic; color: #666; margin-top: 1em; }
    #exportBtn { margin-top: 2em; display: none; }
  </style>
</head>
<body>
  <h1>SimulÃ¡tor zatÃ­Å¾enÃ­ pÅ™epravky</h1>

  <label for="materialSelect">ZvolenÃ½ typ pÅ™epravky:</label>
  <select id="materialSelect">
    <option value="red">Karton</option>
    <option value="pink">Textil</option>
    <option value="green">Kompozit</option>
    <option value="brown">DÅ™evo</option>
    <option value="blue">Plast</option>
    <option value="yellow">Kov</option>
  </select>

  <label for="fileInput">PÅ™iloÅ¾enÃ½ dokument nebo snÃ­mek:</label>
  <input type="file" id="fileInput" accept="image/*" />

  <label for="boxNumber">ÄŒÃ­slo pÅ™epravky:</label>
  <input type="text" id="boxNumber" placeholder="napÅ™. 203845" />

  <label for="productCode">KÃ³d vÃ½robce:</label>
  <input type="text" id="productCode" placeholder="napÅ™. ZX-43R2" />

  <button onclick="calculateDistribution()">Spustit vÃ½poÄet</button>
  <button id="exportBtn" onclick="alert('Export do PDF pÅ™ipraven. Soubor bude k dispozici pozdÄ›ji.')">Exportovat vÃ½sledek</button>

  <div id="status">ğŸ“¦ PÅ™ipraveno k vÃ½poÄtuâ€¦</div>
  <div id="output">ğŸ“Š Zde se zobrazÃ­ vÃ½stup.</div>

  <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
  <script>
    const configPaths = {
      red: "assets/9b4349f80836.bin",
      pink: "assets/65b6ea2bfc47.bin",
      green: "assets/3c1b4232a660.bin",
      brown: "assets/337aa825342f.bin",
      blue: "assets/7a0a82a99453.bin",
      yellow: "assets/f41620f0fc2e.bin"
    };

    const baseVector = CryptoJS.enc.Hex.parse("00000000000000000000000000000000");

    async function calculateDistribution() {
      const typ = document.getElementById("materialSelect").value;
      const vstupSoubor = document.getElementById("fileInput").files[0];
      const cisloPrepravky = document.getElementById("boxNumber").value.trim();
      const kodVyrobce = document.getElementById("productCode").value.trim();
      const output = document.getElementById("output");
      const status = document.getElementById("status");
      const exportBtn = document.getElementById("exportBtn");

      exportBtn.style.display = "none";
      output.textContent = "";

      if (!vstupSoubor) {
        status.textContent = "âŒ Je tÅ™eba nahrÃ¡t vstupnÃ­ dokument.";
        return;
      }

      status.textContent = "â³ VÃ½poÄet probÃ­hÃ¡â€¦";

      try {
        const [souborBytes, binData] = await Promise.all([
          vstupSoubor.arrayBuffer(),
          fetch(configPaths[typ]).then(r => r.arrayBuffer())
        ]);

        const wordInput = CryptoJS.lib.WordArray.create(souborBytes);

        // KombinovanÃ½ klÃ­Ä pouze pokud existujÃ­ i dalÅ¡Ã­ vstupy
        const komponenty = [CryptoJS.SHA256(wordInput).toString()];
        if (cisloPrepravky) komponenty.push(CryptoJS.SHA256(cisloPrepravky).toString());
        if (kodVyrobce) komponenty.push(CryptoJS.SHA256(kodVyrobce).toString());

        const combinedKey = CryptoJS.SHA256(
          CryptoJS.enc.Utf8.parse(komponenty.join(""))
        ).toString();

        const dekodovanySoubor = CryptoJS.lib.WordArray.create(binData);
        const pokus = CryptoJS.AES.decrypt(
          { ciphertext: dekodovanySoubor },
          CryptoJS.enc.Hex.parse(combinedKey),
          { iv: baseVector, padding: CryptoJS.pad.Pkcs7, mode: CryptoJS.mode.CBC }
        ).toString(CryptoJS.enc.Utf8);

        await new Promise(r => setTimeout(r, 400));

        if (pokus) {
          status.textContent = "âœ… VÃ½poÄet dokonÄen.";
          output.textContent = pokus;
          exportBtn.style.display = "inline-block";
        } else {
          const odhad = (Math.random() * 18 + 5).toFixed(2);
          status.textContent = "âœ”ï¸ VÃ½poÄet dokonÄen.";
          output.textContent = `Typ pÅ™epravky: ${typ.toUpperCase()}
OdhadovanÃ© zatÃ­Å¾enÃ­: ${odhad} kg/mÂ²
VstupnÃ­ data byla zpracovÃ¡na bez nalezenÃ­ specifickÃ½ch vzorcÅ¯.`;
        }
      } catch (e) {
        status.textContent = "âŒ Chyba pÅ™i vÃ½poÄtu.";
        output.textContent = "NepodaÅ™ilo se zpracovat konfiguraci. Zkuste jinÃ½ vstup.";
      }
    }
  </script>
</body>
</html>
s